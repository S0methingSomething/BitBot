<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitBot Releases - Latest App Downloads</title>
    <meta name="description" content="Download the latest patched app releases managed by BitBot">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    animation: {
                        'enter': 'enter 0.4s cubic-bezier(0.25, 1, 0.5, 1) forwards',
                        'snap': 'snap 0.2s cubic-bezier(0.25, 1, 0.5, 1)',
                    },
                    keyframes: {
                        enter: {
                            '0%': { opacity: '0', transform: 'translateY(8px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        snap: {
                            '0%': { transform: 'scale(0.98)' },
                            '100%': { transform: 'scale(1)' },
                        }
                    },
                    colors: {
                        'retro-black': '#050505',
                        'retro-panel': '#0c0c0c',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE TEXTURE & PHYSICS --- */
        html { scroll-behavior: smooth; }
        body {
            background-color: #050505;
            color: #ededed;
            overflow-x: hidden;
        }

        /* Background Grid */
        .bg-grid-full {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: -1;
        }

        /* Texture Overlay (Noise) */
        .texture-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            mix-blend-mode: hard-light;
        }

        /* --- COMPONENTS --- */

        /* Panel Styling */
        .panel-textured {
            background-color: rgba(12, 12, 12, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05);
        }

        /* Inputs (Cutout Style) */
        .input-cutout {
            background-color: #080808;
            border: 1px solid #222;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
            transition: border-color 0.1s ease, background-color 0.1s ease, box-shadow 0.1s ease;
        }
        .input-cutout:focus {
            outline: none;
            border-color: #555;
            background-color: #000;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Buttons (Tactile) */
        .btn-tactile {
            transition: transform 0.05s linear, filter 0.05s linear;
        }
        .btn-tactile:active {
            transform: scale(0.98) translateY(1px);
            filter: brightness(0.85);
        }

        /* Card hover effect */
        .app-section {
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .app-section:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -15px rgba(99, 102, 241, 0.15);
        }

        /* Badge pulse */
        @keyframes badge-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .latest-badge { animation: badge-pulse 2s ease-in-out infinite; }

        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background-color: rgba(8, 8, 8, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 1px #000, 0 25px 50px -12px rgba(0,0,0,0.9);
            transform: scale(0.98) translateY(5px);
            transition: transform 0.2s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        /* Modal Stripes */
        .modal-stripes {
            background-image: repeating-linear-gradient(
                -45deg,
                transparent,
                transparent 4px,
                rgba(255, 255, 255, 0.03) 4px,
                rgba(255, 255, 255, 0.03) 8px
            );
        }

        /* Details/Summary Animation */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .2s ease-in-out; }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-5px)}
            100%  {opacity: 1; transform: translateY(0)}
        }
        .history-arrow { transition: transform 0.2s ease; }
        details[open] .history-arrow { transform: rotate(90deg); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center relative">

    <!-- Backgrounds -->
    <div class="bg-grid-full"></div>
    <div class="texture-overlay"></div>

    <div class="content-wrapper w-full flex flex-col items-center max-w-6xl mx-auto px-4 py-10 sm:py-16 z-10">
        
        <!-- Header Card -->
        <div class="w-full panel-textured rounded-xl p-8 mb-10 animate-enter border-t border-white/5">
            <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-600 to-violet-800 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-900/20 border border-white/10">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-4xl font-display font-bold tracking-tight text-white mb-2">BitBot Releases</h1>
                    <p class="text-sm font-mono text-zinc-400 uppercase tracking-widest">Automated Distribution System</p>
                </div>
            </div>
            
            <!-- Info Box -->
            <div class="bg-black/30 border border-zinc-800 rounded-lg p-4 mb-6 flex items-start gap-3">
                <svg class="w-5 h-5 text-indigo-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="text-sm text-zinc-300 leading-relaxed">
                    <span class="font-bold text-white block mb-1">Installation Guide</span>
                    Need help installing MonetizationVars? Check out the 
                    <a href="https://s0methingsomething.github.io/BitGuides/modding/monetizationvars/unlocking-iap/" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:text-indigo-300 hover:underline decoration-1 decoration-indigo-400/30 underline-offset-2 transition-colors">BitGuides Installation Guide</a>.
                </div>
            </div>

            <div class="flex items-center gap-4 text-[10px] font-mono text-zinc-500 uppercase tracking-wider border-t border-white/5 pt-4">
                <span>Maintained by <a href="https://www.reddit.com/u/C1oudyLol/" target="_blank" rel="noopener noreferrer" class="text-zinc-300 hover:text-white transition-colors">/u/C1oudyLol</a></span>
                <span class="w-1 h-1 bg-zinc-700 rounded-full"></span>
                <span class="text-emerald-500 font-bold">{{ apps|length }} APPS INDEXED</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="w-full flex flex-col md:flex-row gap-4 mb-8 animate-enter" style="animation-delay: 0.1s;">
            <!-- Search -->
            <div class="flex-grow relative group">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500 group-focus-within:text-indigo-400 transition-colors pointer-events-none">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <input type="text" id="searchInput" placeholder="SEARCH APPS..." class="search-input input-cutout w-full pl-10 pr-10 py-3.5 rounded-lg text-sm font-mono text-zinc-200 placeholder-zinc-600">
                <button id="clearSearch" class="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-white hidden transition-colors" aria-label="Clear search">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- Sort -->
            <div class="relative min-w-[200px]">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path></svg>
                </div>
                <select id="sort-select" class="sort-select input-cutout w-full pl-10 pr-8 py-3.5 rounded-lg text-sm font-mono text-zinc-300 appearance-none cursor-pointer">
                    <option value="default">Default Order</option>
                    <optgroup label="By Name" class="bg-black text-zinc-400">
                        <option value="alpha-asc">Name (A-Z)</option>
                        <option value="alpha-desc">Name (Z-A)</option>
                    </optgroup>
                    <optgroup label="By Date" class="bg-black text-zinc-400">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                    </optgroup>
                </select>
                <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-600">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>

        <!-- App Grid -->
        <div id="app-list" class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-enter" style="animation-delay: 0.2s;">
            {% for app in apps %}
            <section class="app-section panel-textured rounded-xl flex flex-col hover:border-zinc-600 group" data-app-name="{{app.display_name}}" data-latest-release-date="{{app.latest_release.published_at}}">
                
                <header class="p-6 border-b border-white/5">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-display font-bold text-white tracking-wide flex items-center gap-2">
                            {{app.display_name}}
                        </h2>
                        <span class="latest-badge text-[10px] font-mono font-bold bg-emerald-900/50 text-emerald-400 px-2 py-1 rounded border border-emerald-500/20">LATEST</span>
                    </div>

                    {% if app.latest_release %}
                    <div class="latest-release space-y-4">
                        <div class="flex flex-col gap-1">
                            <h3 class="text-2xl font-mono text-zinc-200 font-bold">v{{app.latest_release.version}}</h3>
                            <p class="release-date text-[10px] font-mono text-zinc-500 uppercase tracking-wider" data-date="{{app.latest_release.published_at}}"></p>
                        </div>
                        
                        <a href="{{app.latest_release.download_url}}" class="download-button btn-tactile block w-full text-center bg-zinc-100 hover:bg-white text-black px-4 py-3 rounded-lg font-bold text-xs uppercase tracking-wide shadow-[0_0_15px_rgba(255,255,255,0.1)] transition-all flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download Release
                        </a>
                    </div>
                    {% else %}
                        <p class="text-center text-xs font-mono text-zinc-600 py-4 italic">No releases found.</p>
                    {% endif %}
                </header>

                {% if app.releases %}
                <div class="history-container p-4 bg-black/20 mt-auto">
                    <details class="history-details group/details">
                        <summary class="flex items-center justify-between cursor-pointer p-2 rounded hover:bg-white/5 transition-colors select-none">
                            <span class="history-toggle-text text-[10px] font-mono font-bold text-zinc-500 uppercase tracking-widest">Version History</span>
                            <svg class="history-arrow w-3 h-3 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </summary>
                        
                        <div class="mt-3 space-y-2 pl-2 border-l border-zinc-800 ml-2">
                            {% for release in app.releases %}
                            <div class="release-item flex items-center justify-between py-1 group/item">
                                <div>
                                    <h3 class="text-xs font-mono text-zinc-300">v{{release.version}}</h3>
                                    <p class="release-date text-[9px] font-mono text-zinc-600" data-date="{{release.published_at}}"></p>
                                </div>
                                <a href="{{release.download_url}}" class="download-button btn-tactile text-[10px] font-bold text-indigo-400 border border-indigo-500/30 px-3 py-1.5 rounded hover:bg-indigo-500 hover:text-white transition-all uppercase">
                                    Get
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                </div>
                {% endif %}
            </section>
            {% endfor %}
        </div>
        
        <div id="no-results" class="hidden text-center py-20" aria-live="polite">
            <h3 class="text-xl font-display font-bold text-zinc-300">No Apps Found</h3>
            <p class="text-zinc-600 text-sm font-mono mt-2">Adjust your search parameters.</p>
        </div>

        <footer class="w-full text-center mt-16 text-[10px] font-mono text-zinc-600 uppercase tracking-widest border-t border-white/5 pt-8">
            <p>Generated by BitBot &bull; <a href="https://github.com/{{bot_repo}}" target="_blank" rel="noopener noreferrer" class="text-zinc-400 hover:text-white transition-colors">View Repository</a></p>
        </footer>
    </div>

    <!-- Download Confirmation Modal -->
    <div id="download-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content w-full max-w-md rounded-xl overflow-hidden">
            <!-- Header -->
            <div class="p-5 border-b border-white/10 bg-black/40 modal-stripes flex justify-between items-center">
                <h3 id="modal-title" class="text-lg font-display font-bold text-white tracking-wide">Confirmation</h3>
                <button id="modal-close-x" class="text-zinc-500 hover:text-white text-xl leading-none transition-colors" aria-label="Close dialog">&times;</button>
            </div>
            
            <div class="p-6">
                <p class="text-sm text-zinc-300 font-medium mb-4">Before installing, ensure the file is named exactly:</p>
                
                <div class="bg-black/50 border border-zinc-800 rounded p-4 mb-6 text-center shadow-inner">
                    <code class="text-base font-mono font-bold text-emerald-400">MonetizationVars</code>
                </div>
                
                <p class="text-xs text-zinc-500 mb-6 border-t border-white/5 pt-3">
                    Need support? Visit <a href="https://www.reddit.com/r/BitLifeRebels/" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:underline">r/BitLifeRebels</a>
                </p>
                
                <div class="flex gap-3">
                    <button id="modal-cancel" class="btn-tactile flex-1 px-4 py-3 border border-zinc-700 text-zinc-300 rounded-lg text-xs font-bold font-mono uppercase hover:bg-zinc-800 transition-colors">Cancel</button>
                    <button id="modal-confirm" class="btn-tactile flex-1 px-4 py-3 bg-indigo-600 text-white rounded-lg text-xs font-bold font-mono uppercase hover:bg-indigo-500 shadow-lg shadow-indigo-900/20 transition-colors">Download</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const sortSelect = document.getElementById('sort-select');
            const appListContainer = document.getElementById('app-list');
            const clearSearchBtn = document.getElementById('clearSearch');
            const downloadModal = document.getElementById('download-modal');
            const modalCancel = document.getElementById('modal-cancel');
            const modalConfirm = document.getElementById('modal-confirm');
            const modalCloseX = document.getElementById('modal-close-x');
            let pendingDownloadUrl = null;
            
            // Modal Logic
            function openModal() {
                downloadModal.classList.add('active');
                modalConfirm.focus();
            }
            function closeModal() {
                downloadModal.classList.remove('active');
                pendingDownloadUrl = null;
            }

            document.addEventListener('click', (e) => {
                const downloadBtn = e.target.closest('.download-button');
                if (downloadBtn && downloadBtn.tagName === 'A') {
                    e.preventDefault();
                    pendingDownloadUrl = downloadBtn.href;
                    openModal();
                }
            });
            
            modalCancel.addEventListener('click', closeModal);
            modalCloseX.addEventListener('click', closeModal);
            
            modalConfirm.addEventListener('click', () => {
                if (pendingDownloadUrl) {
                    window.location.href = pendingDownloadUrl;
                }
                closeModal();
            });
            
            downloadModal.addEventListener('click', (e) => {
                if (e.target === downloadModal) closeModal();
            });

            // Escape key closes modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && downloadModal.classList.contains('active')) {
                    closeModal();
                }
            });

            // Staggered card animation
            document.querySelectorAll('.app-section').forEach((card, index) => {
                card.style.animationDelay = `${0.2 + (index * 0.05)}s`;
            });
            
            // Data & Sorting Logic
            const appData = Array.from(appListContainer.querySelectorAll('.app-section')).map(element => {
                const dateStr = element.dataset.latestReleaseDate;
                let latestReleaseDate = new Date(0);
                if (dateStr) {
                    const parsedDate = new Date(dateStr);
                    if (!isNaN(parsedDate.getTime())) latestReleaseDate = parsedDate;
                }
                
                const historyContainer = element.querySelector('.history-container');
                if (historyContainer && !historyContainer.querySelector('.release-item')) {
                    historyContainer.style.display = 'none';
                }

                return { element, name: element.dataset.appName, latestReleaseDate };
            });

            function formatReleaseDate(isoString) {
                if (!isoString) return '';
                const date = new Date(isoString);
                return date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
            }

            function updateAppList() {
                const searchQuery = searchInput.value.toLowerCase();
                const sortValue = sortSelect.value;
                const filteredApps = appData.filter(app => app.name.toLowerCase().includes(searchQuery));

                let sortedApps = [...filteredApps];
                switch (sortValue) {
                    case 'alpha-asc': sortedApps.sort((a, b) => a.name.localeCompare(b.name)); break;
                    case 'alpha-desc': sortedApps.sort((a, b) => b.name.localeCompare(a.name)); break;
                    case 'date-desc': sortedApps.sort((a, b) => b.latestReleaseDate - a.latestReleaseDate); break;
                    case 'date-asc': sortedApps.sort((a, b) => a.latestReleaseDate - b.latestReleaseDate); break;
                }

                const noResultsMessage = document.getElementById('no-results');
                appListContainer.innerHTML = '';
                if (sortedApps.length > 0) {
                    sortedApps.forEach(app => appListContainer.appendChild(app.element));
                    noResultsMessage.classList.add('hidden');
                } else {
                    noResultsMessage.classList.remove('hidden');
                }
            }
            
            document.querySelectorAll('[data-date]').forEach(el => el.textContent = formatReleaseDate(el.dataset.date));

            appListContainer.addEventListener('click', (event) => {
                const summary = event.target.closest('summary');
                if (!summary) return;
                const details = summary.parentElement;
                const toggleText = summary.querySelector('.history-toggle-text');
                setTimeout(() => {
                    if (toggleText) toggleText.textContent = details.open ? 'Hide History' : 'Version History';
                }, 0);
            });

            function saveSearch(query) {
                localStorage.setItem('bitbot_search', query);
                clearSearchBtn.classList.toggle('hidden', query === '');
            }

            function saveSort(value) {
                localStorage.setItem('bitbot_sort', value);
            }

            searchInput.addEventListener('input', () => {
                saveSearch(searchInput.value);
                updateAppList();
            });
            sortSelect.addEventListener('change', () => {
                saveSort(sortSelect.value);
                updateAppList();
            });
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                saveSearch('');
                updateAppList();
            });
            
            function loadPersistentState() {
                const savedSort = localStorage.getItem('bitbot_sort');
                const savedSearch = localStorage.getItem('bitbot_search');
                if (savedSort) {
                    sortSelect.value = savedSort;
                }
                if (savedSearch) {
                    searchInput.value = savedSearch;
                    clearSearchBtn.classList.remove('hidden');
                }
                updateAppList();
            }

            loadPersistentState();
        });
    </script>
</body>
</html>
